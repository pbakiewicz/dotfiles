setopt prompt_subst # variable substiution in promtp

# Find and set branch name var if in git repository.
function git_branch_name()
{
  unstaged_files=$(git status --porcelain 2> /dev/null | wc -l)
  if [[ ${unstaged_files} -eq 0 ]];
  then
      emoticon="🐝"
  else
      emoticon="⚙️ "
  fi

  # Tutaj przykład mojego przekombinowania. Trzeba było najpierw po prostu sprawdzić,
  # czy jesteśmy w repo, a dopiero później brać git.
  # branch=$(git branch 2> /dev/null | grep '\*' | awk '{print $NF}' | head -n1)
  if $(git rev-parse --is-inside-work-tree >/dev/null 2>&1); then
      branch=$(git rev-parse --abbrev-ref HEAD)
    echo " ${emoticon} %B${branch}%b:"
  else
      :
  fi
}

# Ciekawe, że wartosć PROMPTa jest zwracana tylko raz, ale funkcjoa git_branch_name
# jest ewaulowana przy każdym cd.
PROMPT='%F{208}%~%f$(git_branch_name) ' 
